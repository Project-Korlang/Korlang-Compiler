// Native Korlang runtime: context switching hooks (stubs)

module runtime.context_switch

struct Context {
  sp: UInt;
  pc: UInt;
}

fun ctx_switch_asm(from_sp_ptr: UInt, to_sp: UInt) -> Bool

fun ctx_make(entry: UInt, stack_top: UInt) -> Context {
  Context { sp: stack_top, pc: entry }
}

fun ctx_switch(from: Context, to: Context) -> Bool {
  // Use arch-specific assembly to preserve register state.
  ctx_switch_asm(ptr_of(from.sp), to.sp)
}

fun ptr_of(v: UInt) -> UInt
